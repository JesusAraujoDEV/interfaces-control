<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen OS - Maestro de Productos</title>
    <script src="/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            margin: 0;
        }

        .main-content {
            flex: 1;
            padding: 2rem 3rem;
            overflow-y: auto;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 800;
            color: #111827;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Controles Superiores */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            position: relative;
            min-width: 200px;
        }

        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }

        .search-box input {
            width: 100%;
            padding: 10px 10px 10px 40px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            outline: none;
            box-sizing: border-box;
        }

        select {
            padding: 10px 15px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            cursor: pointer;
        }

        .btn-primary {
            background-color: #2563eb;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        /* Grid de Productos */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .card:hover {
            transform: translateY(-4px);
        }

        .card-img {
            height: 180px;
            width: 100%;
            object-fit: cover;
            background-color: #f3f4f6;
        }

        .card-body {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .card-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #dcfce7;
            color: #166534;
        }

        .status-inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin: 0 0 8px 0;
        }

        .card-desc {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .price {
            font-size: 1.25rem;
            font-weight: 800;
            color: #2563eb;
        }

        .category-tag {
            background: #f3f4f6;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .card-actions {
            padding: 10px 20px;
            background: #f9fafb;
            display: flex;
            gap: 10px;
            border-top: 1px solid #f3f4f6;
        }

        .action-btn {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            background: white;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .action-btn:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .btn-delete:hover {
            background: #fee2e2;
            color: #991b1b;
            border-color: #fecaca;
        }

        /* Modales - Forzamos para que styles.css no rompa la lógica inline */
        body .modal {
            display: none !important;
            /* Ganamos al block !important de styles.css para que no se vean por defecto */
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        /* Clase para mostrar la modal */
        body .modal.active {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            pointer-events: auto !important;
        }

        body .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            position: relative;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            animation: slideDown 0.3s ease-out;
            transform: none !important;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .close {
            font-size: 28px;
            font-weight: bold;
            color: #9ca3af;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            box-sizing: border-box;
        }

        /* Toast */
        .toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 12px;
            position: fixed;
            z-index: 1001;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
        }

        .toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }

        .toast.success {
            background-color: #059669;
        }

        .toast.error {
            background-color: #dc2626;
        }

        .empty-state {
            grid-column: 1/-1;
            text-align: center;
            padding: 40px;
            color: #9ca3af;
        }

        /* Toggle Switch Styles */
        .switch {
            position: relative;
            display: inline-block;
            width: 34px;
            height: 20px;
            vertical-align: middle;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 12px;
            width: 12px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked+.slider {
            background-color: #059669;
            /* Green success */
        }

        input:focus+.slider {
            box-shadow: 0 0 1px #059669;
        }

        input:checked+.slider:before {
            -webkit-transform: translateX(14px);
            -ms-transform: translateX(14px);
            transform: translateX(14px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
    </style>
    <link rel="stylesheet" href="styles.css">

</head>

<body class="app-container">

    <aside class="sidebar">
        <div class="sidebar__profile">
            <div class="w-9 h-9 rounded-xl bg-brand-50 text-brand-800 flex items-center justify-center shrink-0">
                <img src="/assets/charlotte_logo.png" alt="Charlotte Bistró" class="w-8 h-8 object-contain" loading="eager">
            </div>
            <div class="min-w-0">
                <div class="text-sm font-extrabold text-slate-900 leading-5">Cocina</div>
                <div class="text-xs text-slate-500 leading-4 truncate">Dashboard Operativo</div>
            </div>
            <a href="/admin" class="mt-3 inline-flex items-center gap-2 text-xs text-gray-500 hover:text-gray-800">
                <span aria-hidden="true">←</span>
                <span>Volver a Admin</span>
            </a>
        </div>

        <nav class="sidebar__nav">
            <a href="index.html" class="sidebar__link">
                <i data-lucide="layout-dashboard"></i>
                <span class="link-text min-w-0">
                    <div class="text-sm font-semibold leading-5">Dashboard</div>
                    <div class="text-xs text-slate-500 leading-4 truncate atc-nav-desc">Resumen</div>
                </span>
            </a>
            <a href="kds.html" class="sidebar__link">
                <i data-lucide="monitor"></i>
                <span class="link-text min-w-0">
                    <div class="text-sm font-semibold leading-5">KDS</div>
                    <div class="text-xs text-slate-500 leading-4 truncate atc-nav-desc">Cola de producción</div>
                </span>
            </a>
            <a href="Despacho.html" class="sidebar__link">
                <i data-lucide="truck"></i>
                <span class="link-text min-w-0">
                    <div class="text-sm font-semibold leading-5">Despacho</div>
                    <div class="text-xs text-slate-500 leading-4 truncate atc-nav-desc">Entregas a camareros</div>
                </span>
            </a>
            <a href="rec-pro.html" class="sidebar__link sidebar__link--active">
                <i data-lucide="chef-hat"></i>
                <span class="link-text min-w-0">
                    <div class="text-sm font-semibold leading-5">Recetas</div>
                    <div class="text-xs text-slate-500 leading-4 truncate atc-nav-desc">Maestro de productos</div>
                </span>
            </a>
            <a href="inv.html" class="sidebar__link">
                <i data-lucide="package"></i>
                <span class="link-text min-w-0">
                    <div class="text-sm font-semibold leading-5">Inventario</div>
                    <div class="text-xs text-slate-500 leading-4 truncate atc-nav-desc">Consumibles y stock</div>
                </span>
            </a>
            <a href="activos.html" class="sidebar__link">
                <i data-lucide="box"></i>
                <span class="link-text min-w-0">
                    <div class="text-sm font-semibold leading-5">Activos</div>
                    <div class="text-xs text-slate-500 leading-4 truncate atc-nav-desc">Equipos y utensilios</div>
                </span>
            </a>
            <a href="personal.html" class="sidebar__link">
                <i data-lucide="users"></i>
                <span class="link-text min-w-0">
                    <div class="text-sm font-semibold leading-5">Personal</div>
                    <div class="text-xs text-slate-500 leading-4 truncate atc-nav-desc">Staff y turnos</div>
                </span>
            </a>
            <a href="historial_pedidos.html" class="sidebar__link">
                <i data-lucide="history"></i>
                <span class="link-text min-w-0">
                    <div class="text-sm font-semibold leading-5">Historial</div>
                    <div class="text-xs text-slate-500 leading-4 truncate atc-nav-desc">Pedidos y acciones</div>
                </span>
            </a>
        </nav>

        <div class="sidebar__footer">
            <div id="dp-sidebar-toggle-slot" class="sidebar__footer-slot"></div>
            <div class="sidebar__footer-action">
                <a href="/seguridad/logout" aria-label="Cerrar sesión" class="logout-link">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    <span>Cerrar Sesión</span>
                </a>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <button class="sidebar-toggle" aria-label="Abrir menú"><i data-lucide="menu"></i></button>
        <h1><i class="fas fa-utensils"></i> Maestro de Productos</h1>

        <div class="dashboard-grid" id="dashboard-stats"></div>

        <div class="controls">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Buscar productos..." onkeyup="filterProducts()">
            </div>

            <select id="categoryFilter" onchange="filterByCategory()">
                <option value="all">Todas las Categorías</option>
            </select>

            <button class="btn-primary" onclick="openCreateProductModal()">
                <i class="fas fa-plus"></i> Nuevo Producto
            </button>

            <button class="btn-primary" style="background-color: #4b5563;" onclick="openCategoryModal()">
                <i class="fas fa-tags"></i> Categorías
            </button>
        </div>

        <div class="grid-container" id="productsGrid"></div>
    </main>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Nuevo Producto</h2>
                <span class="close" onclick="closeModal('productModal')">&times;</span>
            </div>
            <form id="productForm" onsubmit="saveProduct(event)">
                <input type="hidden" id="prodId">

                <div class="form-group">
                    <label>Nombre del Producto</label>
                    <input type="text" id="prodName" class="form-input" required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Precio Base ($)</label>
                        <input type="number" step="0.01" id="prodPrice" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Categoría</label>
                        <select id="prodCategory" class="form-input" required></select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Descripción</label>
                    <textarea id="prodDesc" class="form-input" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>Imagen</label>
                    <input type="file" id="prodImage" accept="image/*" class="form-input">
                </div>

                <button type="submit" class="btn-primary" style="width: 100%; justify-content: center;">Guardar</button>
            </form>
        </div>
    </div>

    <div id="recipeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configurar Receta</h2>
                <span class="close" onclick="closeModal('recipeModal')">&times;</span>
            </div>
            <div style="display: flex; gap: 10px; margin-bottom: 15px; align-items: center;">
                <select id="ingredientSelect" class="form-input" style="flex:2"></select>
                <input type="number" id="ingredientQty" class="form-input" placeholder="Cant." style="flex:1">
                <div style="display: flex; align-items: center; gap: 5px; white-space: nowrap;">
                    <input type="checkbox" id="ingredientMandatory" checked style="width: 18px; height: 18px;">
                    <label for="ingredientMandatory" style="font-size: 0.9rem;">Obligatorio</label>
                </div>
                <button onclick="addIngredientToRecipe()" class="btn-primary"><i class="fas fa-plus"></i></button>
            </div>
            <table style="width:100%; border-collapse: collapse;">
                <tbody id="recipeListBody"></tbody>
            </table>
        </div>
    </div>

    <div id="categoryModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Categorías</h2>
                <span class="close" onclick="closeCategoryModal()">&times;</span>
            </div>
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <input type="text" id="catNameInput" class="form-input" placeholder="Nombre...">
                <button onclick="saveCategory()" class="btn-primary">Guardar</button>
                <button id="cancelCatEdit" onclick="resetCategoryForm()" style="display:none; padding:10px;">X</button>
            </div>
            <table style="width:100%">
                <tbody id="categoryListBody"></tbody>
            </table>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script type="module" src="./js/sidebar.js"></script>
    <script>if (window.lucide) lucide.createIcons();</script>
    <script src="js/rec-pro.js"></script>
</body>

</html>