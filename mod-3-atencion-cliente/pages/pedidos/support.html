<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Help & Service - The Golden Spoon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#205638',
                        secondary: '#E8F5E9',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans min-h-screen flex flex-col">

    <header class="md:hidden p-4 text-center bg-white sticky top-0 z-20 shadow-sm">
        <h1 class="text-xl font-bold text-gray-900">Help & Service</h1>
    </header>

    <header class="hidden md:block bg-white border-b border-gray-100 sticky top-0 z-30">
        <div class="container mx-auto max-w-6xl px-4 h-20 flex items-center justify-between">
            <a href="menu.html" class="text-2xl font-bold text-gray-900 tracking-tight hover:text-primary transition">
                Charlotte's Restaurant
            </a>
            <div id="desktop-nav-container" class="flex items-center gap-8"></div>
        </div>
    </header>

    <main class="flex-grow container mx-auto max-w-6xl px-4 py-6 pb-24 md:pb-10 flex flex-col items-center justify-center">
        
        <div class="w-full max-w-md bg-white md:border md:border-gray-100 md:shadow-lg md:rounded-3xl p-6 md:p-10 flex flex-col items-center text-center transition-all">
            
            <div class="bg-orange-50 rounded-full p-8 mb-8 w-40 h-40 flex items-center justify-center relative group cursor-pointer">
                <div class="absolute inset-0 bg-orange-100 rounded-full animate-ping opacity-20 group-hover:opacity-40"></div>
                <span class="material-icons-outlined text-6xl text-orange-500">room_service</span>
            </div>

            <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-3">How can we help?</h2>
            
            <p class="text-gray-500 text-sm md:text-base leading-relaxed mb-8 max-w-xs mx-auto">
                Our team is ready to assist you. Whether you need a refill, napkins, or have a question about the menu.
            </p>

            <div class="w-full space-y-4">
                <button id="callWaiterBtn" onclick="callWaiter()" class="w-full bg-primary hover:bg-green-800 text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition transform active:scale-[0.98] flex items-center justify-center gap-2">
                    <span class="material-icons-outlined">notifications_active</span>
                    Call Waiter
                </button>

                <button onclick="openReport()" class="w-full bg-gray-50 hover:bg-gray-100 text-gray-900 font-semibold py-4 rounded-xl border border-gray-200 transition flex items-center justify-center gap-2">
                    <span class="material-icons-outlined text-gray-500">report_problem</span>
                    Report an Issue
                </button>
            </div>

            <div class="mt-8 pt-8 border-t border-gray-50 w-full hidden md:block">
                <p class="text-xs text-gray-400 font-medium uppercase tracking-widest mb-4">Contact Info</p>
                <div class="flex justify-center gap-8 text-sm text-gray-600">
                    <span class="flex items-center gap-1"><span class="material-icons-outlined text-xs">phone</span> +1 (555) 123-4567</span>
                    <span class="flex items-center gap-1"><span class="material-icons-outlined text-xs">email</span> help@goldenspoon.com</span>
                </div>
            </div>

        </div>
    </main>

    <div id="reportOverlay" class="fixed inset-0 bg-gray-50 z-50 overflow-y-auto hidden flex-col animate-fade-in">
        
        <div class="bg-white p-4 sticky top-0 z-10 flex items-center shadow-sm">
            <button onclick="closeReport()" class="p-2 -ml-2 text-gray-600 hover:bg-gray-100 rounded-full transition">
                <span class="material-icons-outlined text-2xl">arrow_back</span>
            </button>
            <h1 class="text-xl font-bold text-gray-900 ml-2">Report an Issue</h1>
        </div>

        <div class="flex-grow p-6 max-w-md mx-auto w-full">
            
            <h2 class="text-lg font-bold text-gray-900 mb-4">Select Issue</h2>

            <div class="grid grid-cols-2 gap-3 mb-8" id="issueGrid">
                <button onclick="selectChip(this)" class="issue-chip py-3 px-4 rounded-xl border border-gray-200 text-gray-600 font-medium bg-white hover:bg-gray-50 transition text-sm" data-type="COMPLAINT" data-issue="Food Quality">Food Quality</button>
                <button onclick="selectChip(this)" class="issue-chip py-3 px-4 rounded-xl border border-gray-200 text-gray-600 font-medium bg-white hover:bg-gray-50 transition text-sm" data-type="COMPLAINT" data-issue="Cleanliness">Cleanliness</button>
                <button onclick="selectChip(this)" class="issue-chip py-3 px-4 rounded-xl border border-gray-200 text-gray-600 font-medium bg-white hover:bg-gray-50 transition text-sm" data-type="COMPLAINT" data-issue="Utensils">Utensils</button>
                <button onclick="selectChip(this)" class="issue-chip py-3 px-4 rounded-xl border border-gray-200 text-gray-600 font-medium bg-white hover:bg-gray-50 transition text-sm" data-type="COMPLAINT" data-issue="Other">Other</button>
            </div>

            <form onsubmit="submitReport(event)" class="space-y-6">
                <input type="hidden" id="selectedIssueType" value="COMPLAINT">
                <input type="hidden" id="selectedIssue" value="">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Details</label>
                    <textarea 
                        id="issueDetails"
                        class="w-full h-40 p-4 bg-white rounded-2xl border border-gray-200 focus:border-primary focus:ring-2 focus:ring-green-100 outline-none resize-none transition text-gray-700 placeholder-gray-400" 
                        placeholder="Please describe the issue..."
                        required
                    ></textarea>
                </div>

                <button type="submit" id="submitReportBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-xl shadow-lg transition transform active:scale-[0.98] flex items-center justify-center gap-2">
                    <span class="material-icons-outlined">send</span>
                    Send Report
                </button>
            </form>
        </div>
    </div>

    <div id="toast" class="fixed top-24 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 transition-all duration-300 opacity-0 translate-y-[-20px] invisible z-[60]">
    </div>

    <nav id="mobile-nav-container"></nav>

    <script src="../../components/navbar.js"></script>
    <script>
        // --- CONFIGURACI√ìN DE SIMULACI√ìN (LocalStorage) ---
        const SIMULATE_DELAY = 800; // 0.8 segundos para simular llamada a API
        
        // Clave para guardar solicitudes en LocalStorage
        const STORAGE_KEY = 'restaurant_service_requests';
        
        // Funci√≥n para obtener solicitudes guardadas
        function getStoredRequests() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? JSON.parse(stored) : [];
        }
        
        // Funci√≥n para guardar una nueva solicitud
        function saveRequest(request) {
            const requests = getStoredRequests();
            const newRequest = {
                id: Date.now(), // ID √∫nico basado en timestamp
                timestamp: new Date().toISOString(),
                type: request.type,
                issue: request.issue || null,
                message: request.message,
                status: 'pending',
                table: 'Table 5' // Puedes cambiar esto o hacerlo din√°mico
            };
            
            requests.push(newRequest);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(requests));
            
            // Mostrar en consola para debug
            console.log('üìù Solicitud guardada:', newRequest);
            console.log('üìã Total de solicitudes:', requests.length);
            
            return newRequest;
        }
        
        // Funci√≥n para simular llamada a API
        function simulateApiCall(data) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    try {
                        const savedRequest = saveRequest(data);
                        resolve({
                            success: true,
                            message: 'Request processed successfully',
                            data: savedRequest
                        });
                    } catch (error) {
                        reject(new Error('Failed to save request'));
                    }
                }, SIMULATE_DELAY);
            });
        }
        
        // --- L√≥gica del Toast ---
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            
            if (type === 'success') {
                toast.className = "fixed top-24 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 transition-all duration-300 z-[60]";
                toast.innerHTML = `<span class="material-icons-outlined text-green-400">check_circle</span> <span class="text-sm font-medium">${message}</span>`;
            } else if (type === 'error') {
                toast.className = "fixed top-24 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 transition-all duration-300 z-[60]";
                toast.innerHTML = `<span class="material-icons-outlined text-white">error</span> <span class="text-sm font-medium">${message}</span>`;
            } else if (type === 'warning') {
                toast.className = "fixed top-24 left-1/2 transform -translate-x-1/2 bg-yellow-500 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 transition-all duration-300 z-[60]";
                toast.innerHTML = `<span class="material-icons-outlined text-white">warning</span> <span class="text-sm font-medium">${message}</span>`;
            }
            
            // Mostrar
            toast.classList.remove('opacity-0', 'translate-y-[-20px]', 'invisible');
            
            // Ocultar
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-[-20px]', 'invisible');
            }, 3000);
        }
        
        // Funci√≥n para llamar al mesero
        async function callWaiter() {
            const btn = document.getElementById('callWaiterBtn');
            const originalText = btn.innerHTML;
            
            try {
                // Cambiar estado del bot√≥n
                btn.disabled = true;
                btn.innerHTML = `<span class="material-icons-outlined animate-spin">refresh</span> Calling...`;
                btn.classList.add('opacity-70', 'cursor-not-allowed');
                
                // Simular llamada a API
                const requestData = {
                    type: "CALL_WAITER",
                    message: "Cliente solicit√≥ asistencia"
                };
                
                const response = await simulateApiCall(requestData);
                
                // Mostrar confirmaci√≥n
                showToast('‚úÖ Waiter has been notified! They will be with you shortly.', 'success');
                
                // Reproducir sonido (opcional)
                playNotificationSound();
                
            } catch (error) {
                console.error('Error calling waiter:', error);
                showToast('‚ùå Failed to call waiter. Please try again.', 'error');
            } finally {
                // Restaurar bot√≥n
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    btn.classList.remove('opacity-70', 'cursor-not-allowed');
                }, 2000);
            }
        }
        
        // --- L√≥gica del Report Overlay ---
        const reportOverlay = document.getElementById('reportOverlay');
        let selectedIssue = '';
        
        function openReport() {
            // Resetear formulario
            document.getElementById('issueDetails').value = '';
            selectedIssue = '';
            document.getElementById('selectedIssue').value = '';
            
            // Deseleccionar todos los chips
            document.querySelectorAll('.issue-chip').forEach(chip => {
                chip.className = "issue-chip py-3 px-4 rounded-xl border border-gray-200 text-gray-600 font-medium bg-white hover:bg-gray-50 transition text-sm";
            });
            
            // Mostrar overlay
            reportOverlay.classList.remove('hidden');
            reportOverlay.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }
        
        function closeReport() {
            reportOverlay.classList.add('hidden');
            reportOverlay.classList.remove('flex');
            document.body.style.overflow = 'auto';
        }
        
        // Selecci√≥n de Chips
        function selectChip(btn) {
            // 1. Quitar estado activo de todos
            document.querySelectorAll('.issue-chip').forEach(chip => {
                chip.className = "issue-chip py-3 px-4 rounded-xl border border-gray-200 text-gray-600 font-medium bg-white hover:bg-gray-50 transition text-sm";
            });
            
            // 2. Activar el clickeado
            btn.className = "issue-chip py-3 px-4 rounded-xl border-2 border-primary text-primary font-bold bg-green-50 transition text-sm";
            
            // 3. Guardar la selecci√≥n
            selectedIssue = btn.getAttribute('data-issue');
            document.getElementById('selectedIssue').value = selectedIssue;
        }
        
        // Funci√≥n para enviar reporte
        async function submitReport(e) {
            e.preventDefault();
            
            const details = document.getElementById('issueDetails').value.trim();
            const submitBtn = document.getElementById('submitReportBtn');
            const originalText = submitBtn.innerHTML;
            
            // Validaci√≥n
            if (!selectedIssue) {
                showToast('‚ö†Ô∏è Please select an issue type', 'warning');
                return;
            }
            
            if (!details) {
                showToast('‚ö†Ô∏è Please describe the issue', 'warning');
                return;
            }
            
            try {
                // Cambiar estado del bot√≥n
                submitBtn.disabled = true;
                submitBtn.innerHTML = `<span class="material-icons-outlined animate-spin">refresh</span> Sending...`;
                submitBtn.classList.add('opacity-70', 'cursor-not-allowed');
                
                // Preparar datos
                const requestData = {
                    type: "COMPLAINT",
                    issue: selectedIssue,
                    message: `${selectedIssue}: ${details}`
                };
                
                // Simular llamada a API
                const response = await simulateApiCall(requestData);
                
                // Cerrar modal
                closeReport();
                
                // Mostrar confirmaci√≥n
                setTimeout(() => {
                    showToast('üì§ Report sent successfully. We are on it.', 'success');
                }, 300);
                
            } catch (error) {
                console.error('Error submitting report:', error);
                showToast('‚ùå Failed to send report. Please try again.', 'error');
            } finally {
                // Restaurar bot√≥n
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                submitBtn.classList.remove('opacity-70', 'cursor-not-allowed');
            }
        }
        
        // Funci√≥n para reproducir sonido de notificaci√≥n
        function playNotificationSound() {
            try {
                // Crear un tono simple
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Audio context not supported - silent mode');
            }
        }
        
        // --- FUNCI√ìN EXTRA: Ver solicitudes guardadas (para debug) ---
        function debugShowRequests() {
            const requests = getStoredRequests();
            console.log('=== SOLICITUDES GUARDADAS ===');
            requests.forEach((req, index) => {
                console.log(`${index + 1}. ${req.type} - ${req.issue || 'N/A'}`);
                console.log(`   üìù ${req.message}`);
                console.log(`   ‚è∞ ${new Date(req.timestamp).toLocaleTimeString()}`);
                console.log(`   üìç ${req.table} | Status: ${req.status}`);
                console.log('---');
            });
            
            // Mostrar tambi√©n en un alert (opcional)
            if (requests.length > 0) {
                alert(`Hay ${requests.length} solicitudes guardadas.\nRevisa la consola (F12) para ver los detalles.`);
            } else {
                alert('No hay solicitudes guardadas todav√≠a.');
            }
        }
        
        // Agregar bot√≥n de debug (opcional - remover en producci√≥n)
        window.addEventListener('DOMContentLoaded', () => {
            // Bot√≥n flotante para debug
            const debugBtn = document.createElement('button');
            debugBtn.textContent = 'üõ†Ô∏è Debug';
            debugBtn.id = 'debugBtn';
            debugBtn.style.cssText = 'position:fixed;bottom:20px;right:20px;background:#666;color:white;padding:8px 12px;border-radius:20px;font-size:12px;z-index:1000;border:none;cursor:pointer;box-shadow:0 2px 10px rgba(0,0,0,0.2);';
            debugBtn.onclick = debugShowRequests;
            debugBtn.title = 'Ver solicitudes guardadas en LocalStorage';
            document.body.appendChild(debugBtn);
            
            // Bot√≥n para limpiar datos
            const clearBtn = document.createElement('button');
            clearBtn.textContent = 'üóëÔ∏è Clear';
            clearBtn.id = 'clearBtn';
            clearBtn.style.cssText = 'position:fixed;bottom:60px;right:20px;background:#dc2626;color:white;padding:8px 12px;border-radius:20px;font-size:12px;z-index:1000;border:none;cursor:pointer;box-shadow:0 2px 10px rgba(0,0,0,0.2);';
            clearBtn.onclick = function() {
                if (confirm('¬øEst√°s seguro de que quieres borrar todas las solicitudes guardadas?')) {
                    localStorage.removeItem(STORAGE_KEY);
                    alert('Datos borrados correctamente.');
                    console.log('üóëÔ∏è LocalStorage limpiado.');
                }
            };
            clearBtn.title = 'Borrar todas las solicitudes';
            document.body.appendChild(clearBtn);
        });
        
        // Manejar la tecla Escape para cerrar el modal
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !reportOverlay.classList.contains('hidden')) {
                closeReport();
            }
        });
        
        // Mostrar mensaje de bienvenida en consola
        console.log('üöÄ Sistema de Ayuda - Modo LocalStorage activado');
        console.log('üìå Las solicitudes se guardan en: ' + STORAGE_KEY);
        console.log('‚ÑπÔ∏è Usa el bot√≥n üõ†Ô∏è Debug para ver las solicitudes guardadas');
    </script>

    <style>
        /* Animaci√≥n suave para el overlay */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.2s ease-out;
        }
        
        /* Animaci√≥n de spinner */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        /* Estilos para los botones de debug */
        #debugBtn:hover, #clearBtn:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease;
        }
        #debugBtn:hover {
            background: #555 !important;
        }
        #clearBtn:hover {
            background: #b91c1c !important;
        }
    </style>
</body>
</html>