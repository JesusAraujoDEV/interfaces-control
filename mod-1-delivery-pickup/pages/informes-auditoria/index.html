<!doctype html>
<html lang="es">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Audit Command Center â€” Delivery & Pickup</title>
	<link rel="icon" type="image/x-icon" href="/favicon.ico" />
	<link rel="stylesheet" href="/styles/tailwind.css" />
	<link rel="stylesheet" href="/shared/styles/global.css" />
	<link rel="stylesheet" href="/mod-1-delivery-pickup/pages/informes-auditoria/page.css" />
</head>

<body class="antialiased text-slate-900">
	<header class="flex items-start sm:items-center justify-between gap-4">
		<div>
			<h1 class="text-2xl sm:text-3xl font-extrabold">ğŸ¯ Audit Command Center</h1>
			<p class="mt-1 text-sm text-slate-600">Centro de comando de auditorÃ­a operativa.</p>
		</div>
		<div class="flex items-center gap-2">
			<button id="dpAuditRefresh" type="button"
				class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold text-slate-800 hover:bg-slate-50">
				ğŸ”„ Actualizar
			</button>
			<button id="dpAuditExport" type="button"
				class="inline-flex items-center justify-center rounded-xl bg-brand-800 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-brand-700">
				ğŸ“¥ Exportar
			</button>
		</div>
	</header>

	<main class="mt-5">
		<!-- Smart Omni-Search -->
		<section class="mb-5">
			<div class="omni-search-container">
				<span class="omni-search-icon">ğŸ”</span>
				<input id="omniSearch" type="text" class="omni-search"
					placeholder="Buscar por UUID, ID de orden (DL-####), manager, o cualquier texto..."
					autocomplete="off" />
				<button id="omniSearchClear" class="omni-search-clear" aria-label="Limpiar bÃºsqueda">âœ•</button>
			</div>
		</section>

		<!-- Filter Chips -->
		<section class="mb-5">
			<div class="filter-chips">
				<button class="filter-chip filter-chip--alert" data-filter="alert">
					<span class="filter-chip__icon">ğŸ”´</span>
					<span>Alertas</span>
				</button>
				<button class="filter-chip filter-chip--order active" data-filter="order">
					<span class="filter-chip__icon">ğŸ”</span>
					<span>Ã“rdenes</span>
				</button>
				<button class="filter-chip filter-chip--config" data-filter="config">
					<span class="filter-chip__icon">âš™ï¸</span>
					<span>ConfiguraciÃ³n</span>
				</button>
				<div style="width: 1px; height: 24px; background: rgb(226 232 240); margin: 0 0.25rem;"></div>
				<select id="dpAuditManagerFilter" class="dp-filter" aria-label="Manager" style="min-width: 200px;">
					<option value="">ğŸ‘¤ Todos los Managers</option>
				</select>
				<div class="dp-range">
					<span class="dp-range__icon" aria-hidden="true">ğŸ“…</span>
					<input id="dpAuditFrom" type="datetime-local" class="dp-range__input" />
					<span class="dp-range__sep" aria-hidden="true">â€”</span>
					<input id="dpAuditTo" type="datetime-local" class="dp-range__input" />
				</div>
				<select id="dpAuditLimit" class="dp-filter" aria-label="LÃ­mite" style="min-width: 100px;">
					<option value="50" selected>50</option>
					<option value="100">100</option>
					<option value="200">200</option>
					<option value="500">500</option>
				</select>
				<div class="flex items-center gap-2">
					<button id="dpAuditPrev" type="button" class="dp-icon-btn">â†</button>
					<button id="dpAuditNext" type="button" class="dp-icon-btn">â†’</button>
				</div>
			</div>
		</section>

		<!-- View Container -->
		<div class="grid grid-cols-1 xl:grid-cols-[1fr_420px] gap-4">
			<!-- LIVE FEED VIEW (Default) -->
			<section id="liveFeedView"
				class="bg-white border border-slate-200 rounded-2xl shadow-[0_1px_0_rgba(16,24,40,0.03)] p-5 min-w-0">
				<div class="flex items-center justify-between mb-4">
					<h2 class="text-lg font-extrabold text-slate-900">ğŸ“Š Live Feed</h2>
					<div id="dpAuditMeta" class="text-xs text-slate-500"></div>
				</div>

				<div id="dpAuditError"
					class="hidden rounded-xl border border-rose-200 bg-rose-50 p-3 text-sm text-rose-800 mb-4"></div>

				<div class="dp-table-wrap">
					<table class="dp-table">
						<thead>
							<tr>
								<th style="width: 180px;">Timestamp</th>
								<th style="width: 140px;">Orden</th>
								<th>Manager</th>
								<th>TransiciÃ³n</th>
								<th>Motivo</th>
								<th style="width: 80px;">JSON</th>
							</tr>
						</thead>
						<tbody id="dpAuditTableBody"></tbody>
					</table>
				</div>
			</section>

			<!-- ORDER TIMELINE VIEW -->
			<section id="timelineView"
				class="timeline-view bg-white border border-slate-200 rounded-2xl shadow-[0_1px_0_rgba(16,24,40,0.03)] p-5 min-w-0">
				<div class="flex items-center justify-between mb-4">
					<h2 class="text-lg font-extrabold text-slate-900">ğŸ“ Order Timeline</h2>
					<button id="closeTimelineView" class="dp-icon-btn">âœ•</button>
				</div>

				<!-- Timeline Header (Order Summary) -->
				<div id="timelineHeader" class="timeline-header">
					<!-- Will be populated by JS -->
				</div>

				<!-- Timeline Events -->
				<div id="timelineContainer" class="timeline-container">
					<div class="timeline-line"></div>
					<!-- Events will be populated by JS -->
				</div>
			</section>

			<!-- SYSTEM LOG VIEW -->
			<section id="systemLogView"
				class="system-log-view bg-white border border-slate-200 rounded-2xl shadow-[0_1px_0_rgba(16,24,40,0.03)] p-5 min-w-0">
				<div class="flex items-center justify-between mb-4">
					<h2 class="text-lg font-extrabold text-slate-900">âš™ï¸ System Log</h2>
					<button id="closeSystemLogView" class="dp-icon-btn">âœ•</button>
				</div>

				<div id="systemLogContainer">
					<!-- Diff cards will be populated by JS -->
				</div>
			</section>

			<!-- DETAIL PANEL (Right Side) -->
			<aside
				class="bg-white border border-slate-200 rounded-2xl shadow-[0_1px_0_rgba(16,24,40,0.03)] p-5 dp-detail"
				aria-live="polite">
				<div class="flex items-start justify-between gap-3">
					<div>
						<h2 class="text-lg font-extrabold text-slate-900">ğŸ” Detalle</h2>
						<p id="dpAuditDetailHint" class="mt-1 text-sm text-slate-600">Selecciona un evento para
							inspeccionarlo.</p>
					</div>
					<button id="dpAuditDetailClose" type="button" class="hidden dp-icon-btn"
						aria-label="Cerrar">âœ•</button>
				</div>

				<div id="dpAuditDetail" class="mt-4 hidden">
					<div class="dp-detail-kv">
						<div class="dp-detail-kv__k">Timestamp</div>
						<div id="dpDetailTimestamp" class="dp-detail-kv__v dp-mono"></div>
					</div>
					<div class="dp-detail-kv">
						<div class="dp-detail-kv__k">log_id</div>
						<div id="dpDetailLogId" class="dp-detail-kv__v dp-mono"></div>
					</div>
					<div class="dp-detail-kv">
						<div class="dp-detail-kv__k">order_id</div>
						<div id="dpDetailOrderId" class="dp-detail-kv__v dp-mono"></div>
					</div>
					<div class="dp-detail-kv">
						<div class="dp-detail-kv__k">Manager</div>
						<div id="dpDetailManager" class="dp-detail-kv__v"></div>
					</div>
					<div class="dp-detail-kv">
						<div class="dp-detail-kv__k">Estado</div>
						<div id="dpDetailTransition" class="dp-detail-kv__v dp-mono"></div>
					</div>
					<div class="dp-detail-kv">
						<div class="dp-detail-kv__k">Motivo</div>
						<div id="dpDetailReason" class="dp-detail-kv__v"></div>
					</div>

					<div class="mt-4">
						<a id="dpDetailOpenOrder"
							class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-800 hover:bg-slate-50"
							href="#">Ver pedido</a>
					</div>

					<div class="mt-4">
						<button id="dpDetailOpenJson"
							class="inline-flex items-center justify-center rounded-xl bg-slate-900 px-3 py-2 text-sm font-semibold text-white hover:bg-slate-800 w-full">
							ğŸ“„ Ver JSON Completo
						</button>
					</div>
				</div>
			</aside>
		</div>
	</main>

	<!-- JSON MODAL -->
	<div id="jsonModal" class="json-modal">
		<div class="json-modal-content">
			<div class="json-modal-header">
				<h3 class="json-modal-title">ğŸ“„ Evento JSON</h3>
				<div class="json-modal-actions">
					<button id="jsonCopyBtn" class="json-copy-btn">
						<span id="jsonCopyIcon">ğŸ“‹</span>
						<span id="jsonCopyText">Copiar JSON</span>
					</button>
					<button id="jsonCloseBtn" class="json-close-btn">âœ•</button>
				</div>
			</div>
			<div class="json-modal-body">
				<pre id="jsonContent" class="dp-json"></pre>
			</div>
		</div>
	</div>

	<script type="module" src="/mod-1-delivery-pickup/pages/informes-auditoria/page.js"></script>
</body>

</html>