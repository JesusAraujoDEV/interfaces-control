<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Config</title>
    <script src="api/config.js"></script>
    <script src="js/api.js"></script>
</head>
<body>
    <h1>Configuración de API</h1>
    <div id="config"></div>
    <div id="test"></div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const configDiv = document.getElementById('config');
            const token = localStorage.getItem('jwt_token') || localStorage.getItem('auth_token');

            configDiv.innerHTML = `
                <p><strong>APP_CONFIG:</strong> ${JSON.stringify(window.__APP_CONFIG)}</p>
                <p><strong>API_BASE_URL:</strong> ${window.API_BASE_URL}</p>
                <p><strong>KITCHEN_URL:</strong> ${window.KITCHEN_URL}</p>
                <p><strong>Location:</strong> ${window.location.hostname}:${window.location.port}</p>
                <p><strong>Token presente:</strong> ${token ? '✅ Sí' : '❌ No'}</p>
            `;

            if (!token) {
                document.getElementById('test').innerHTML = `
                    <p><strong>❌ No hay token de autenticación</strong></p>
                    <p>Necesitas hacer login primero en: <a href="/mod-4-seguridad/Inicio%20sesión/Inicio-sesion.html" target="_blank">Login</a></p>
                `;
                return;
            }

            // Test multiple API endpoints
            const testUrls = [
                `${window.KITCHEN_URL}/inventory/items`,
                `${window.API_BASE_URL}/api/kitchen/inventory/items`,
                `${window.KITCHEN_URL}/assets`
            ];

            let results = '';

            for (const testUrl of testUrls) {
                try {
                    results += `<h3>Testing: ${testUrl}</h3>`;

                    const response = await fetch(testUrl, {
                        method: 'GET',
                        headers: getCommonHeaders()
                    });

                    if (response.ok) {
                        const data = await response.json();
                        results += `
                            <p><strong>✅ Success (${response.status}):</strong></p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                    } else {
                        const errorText = await response.text();
                        results += `
                            <p><strong>❌ Error ${response.status}:</strong> ${response.statusText}</p>
                            <p><strong>Response:</strong> ${errorText}</p>
                        `;
                    }
                } catch (error) {
                    results += `<p><strong>❌ Network Error:</strong> ${error.message}</p>`;
                }
                results += '<hr>';
            }

            document.getElementById('test').innerHTML = results;
        });
    </script>
</body>
</html>